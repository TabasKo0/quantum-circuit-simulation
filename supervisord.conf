[supervisord]
nodaemon=true

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
autorestart=true
priority=10

[program:backend]
# Gunicorn runs the Flask/FastAPI app. Ensure gunicorn is installed in backend/requirements.txt.
# This assumes the app object is at backend.app:app
command=gunicorn backend.app:app -b 127.0.0.1:8000 --workers 2
directory=/app
autostart=true
autorestart=true
startretries=3
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
priority=20

[program:frontend]
# Start Next in production mode on port 3000.
# Run from /app/frontend and do NOT re-add a ./frontend prefix (that caused /app/frontend/frontend).
command=npm run start -- -p 3000
directory=/app/frontend
autostart=true
autorestart=true
startretries=3
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
priority=30