[supervisord]
nodaemon=true

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
autorestart=true
priority=10

[program:backend]
# Run Gunicorn to serve the Python app. Adjust module path if needed.
# This assumes your Flask/FastAPI app object is available at backend.app:app
command=gunicorn backend.app:app -b 127.0.0.1:8000 --workers 2
directory=/app
autostart=true
autorestart=true
startretries=3
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
priority=20

[program:frontend]
# Start Next in production mode on port 3000
command=npm run start --prefix ./frontend -- -p 3000
directory=/app/frontend
autostart=true
autorestart=true
startretries=3
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
priority=30